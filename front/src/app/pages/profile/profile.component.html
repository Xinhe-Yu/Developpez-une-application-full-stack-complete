<div class="p2"></div>
@if ($userData | async; as data) {
<div class="form">
  <mat-card>
    <mat-card-header fxLayoutAlign="center center">
      <mat-card-title>Profil utilisateur</mat-card-title>
    </mat-card-header>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <mat-card-content fxLayout="column">

        <mat-form-field appearance="fill">
          <input matInput formControlName="username" [placeholder]="data.user?.username || 'Nom d\'utilisateur'">
          @if (form.get('username')?.hasError('required') && form.get('username')?.touched) {
          <mat-error>username is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <input matInput formControlName="email" [placeholder]="data.user?.email || 'E-mail'">
          @if (form.get('email')?.hasError('required') && form.get('email')?.touched) {
          <mat-error>email is required</mat-error>
          }
        </mat-form-field>


        <mat-form-field appearance="fill">
          <input matInput [type]="hideNewPassword ? 'password' : 'text'" formControlName="newPassword"
            placeholder="Nouveau mot de passe">
          <button mat-icon-button matSuffix (click)="hideNewPassword = !hideNewPassword"
            [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hideNewPassword" type="button">
            <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>

          @if (form.get('newPassword')?.hasError('required') && form.get('newPassword')?.touched) {
          <mat-error>Content is required</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="fill">
          <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password"
            placeholder="Ancien mot de passe">
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hidePassword" type="button">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>

          @if (form.get('password')?.hasError('required') && form.get('password')?.touched) {
          <mat-error>Content is required</mat-error>
          }
        </mat-form-field>

      </mat-card-content>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Sauvegarder</button>
    </form>
    <button mat-button color="warn" (click)="logOut()">Se déconnecter</button>
  </mat-card>
  <div class="p2"></div>
  <hr>
  <div class="p2"></div>

  <mat-card>
    <mat-card-header fxLayoutAlign="center center">
      <mat-card-title>Subscriptions</mat-card-title>
    </mat-card-header>
  </mat-card>
</div>

<div class="grid-two-columns topics">
  @for(topic of data.subscriptions; track topic.id) {
  <mat-card>
    <mat-card-title>
      {{topic.name}}
    </mat-card-title>
    <mat-card-content>
      {{topic.description}}
      On sait depuis longtemps que travailler avec du texte lisible et contenant du sens est source de distractions,
      et empêche de se concentrer sur la mise en page elle-même. L'avantage du Lorem Ipsum sur un texte générique
      comme 'Du texte. Du texte. Du texte.' est qu'il possède une distribution de lettres plus ou moins normale, et en
      tout cas comparable avec celle du français standard. De nombreuses suites logicielles
    </mat-card-content>

    <button mat-raised-button color="primary" (click)="unsubscribe($event, topic)">
      Se désabonner
    </button>
  </mat-card>


  }
</div>
<div class="p2"></div>
}
